var beautifulDlyrics=(()=>{var R=Object.defineProperty,i=Object.getOwnPropertySymbols,V=Object.prototype.hasOwnProperty,_=Object.prototype.propertyIsEnumerable,n=(e,t,r)=>t in e?R(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,a=(e,t)=>{for(var r in t=t||{})V.call(t,r)&&n(e,r,t[r]);if(i)for(var r of i(t))_.call(t,r)&&n(e,r,t[r]);return e},t=new Set;function r(){for(;;){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)});if(!1===t.has(e))return t.add(e),e}}var e,j=class{constructor(){this.Items=new Map,this.DestroyedState=!1}Push(e){var t=r();return this.Items.set(t,e),t}Get(e){return this.Items.get(e)}Remove(e){var t=this.Items.get(e);if(void 0!==t)return this.Items.delete(e),t}GetIterator(){return this.Items.entries()}IsDestroyed(){return this.DestroyedState}Destroy(){this.DestroyedState||(this.DestroyedState=!0,delete this.Items)}},o=class{constructor(e,t){this.ConnectionReferences=e,this.Disconnected=!1,this.Location=e.Push({Callback:t,Connection:this})}Disconnect(){this.Disconnected||(this.Disconnected=!0,this.ConnectionReferences.Remove(this.Location),delete this.Location,delete this.Callback,delete this.SignalConnections)}IsDisconnected(){return this.Disconnected}},N=class{constructor(e){this.Signal=e}Connect(e){return this.Signal.Connect(e)}IsDestroyed(){return this.Signal.IsDestroyed()}},s=class{constructor(){this.ConnectionReferences=new j,this.DestroyedState=!1}Connect(e){if(this.DestroyedState)throw"Cannot connect to a Destroyed Signal";return new o(this.ConnectionReferences,e)}Fire(...e){if(this.DestroyedState)throw"Cannot fire a Destroyed Signal";for(var[t,r]of this.ConnectionReferences.GetIterator())r.Callback(...e)}GetEvent(){return new N(this)}IsDestroyed(){return this.DestroyedState}Destroy(){if(!this.DestroyedState){for(var[e,t]of this.ConnectionReferences.GetIterator())t.Connection.Disconnect();this.DestroyedState=!0,delete this.ConnectionReferences}}},z=e=>e instanceof o,c=class{constructor(e,t){this.Cleaner=e,this.Id=t}Cancel(){void 0!==this.Id&&(this.Cleaner(this.Id),delete this.Id,delete this.Cleaner)}},l=(e,t)=>new c(window.clearTimeout.bind(window),setTimeout(t,1e3*e)),H=e=>e instanceof c,h=class{constructor(){this.Items=new Map,this.DestroyedState=!1,this.DestroyingSignal=new s,this.CleanedSignal=new s,this.DestroyedSignal=new s,this.Destroying=this.DestroyingSignal.GetEvent(),this.Cleaned=this.CleanedSignal.GetEvent(),this.Destroyed=this.DestroyedSignal.GetEvent()}CleanItem(e){e instanceof h?e.Destroy():H(e)?e.Cancel():e instanceof MutationObserver||e instanceof ResizeObserver?e.disconnect():z(e)?e.Disconnect():e instanceof HTMLElement?e.remove():e()}Give(e,t){return this.DestroyedState?this.CleanItem(e):(t=t??r(),this.Has(t)&&this.Clean(t),this.Items.set(t,e)),e}GiveItems(...e){for(const t of e)this.Give(t);return Array.from(arguments)}Has(e){return this.Items.has(e)}Clean(e){var t=this.Items.get(e);void 0!==t&&(this.Items.delete(e),this.CleanItem(t))}CleanUp(){for(var[e,t]of this.Items)this.Clean(e);!1===this.DestroyedState&&this.CleanedSignal.Fire()}IsDestroyed(){return this.DestroyedState}Destroy(){!1===this.DestroyedState&&(this.DestroyedState=!0,this.DestroyingSignal.Fire(),this.CleanUp(),delete this.Items,this.DestroyedSignal.Fire(),this.DestroyingSignal.Destroy(),this.CleanedSignal.Destroy(),this.DestroyedSignal.Destroy(),delete this.DestroyingSignal,delete this.CleanedSignal,delete this.DestroyedSignal)}},d=new h,y=document.currentScript,B=y.src.includes("https://xpui.app.spotify.com/"),u=new s,m=Spicetify.Player,v=Spicetify.CosmosAsync;Spicetify.showNotification;{const M=()=>{m=Spicetify.Player,v=Spicetify.CosmosAsync,e=Spicetify.showNotification,void 0===m||void 0===v||void 0===e?d.Give(l(0,M),"WaitForSpicetify"):u.Fire()};M()}var g,f,b,p,U=u.GetEvent(),S=()=>S,$={TrackInformation:{},ISRCLyrics:{}},J={Analytics:{}},w=new Map,C=(w.set("TrackInformation",1),w.set("ISRCLyrics",3),new Map),x=(C.set("Analytics",1),new class{constructor(){var t,r,i,n,e=this.LoadStore("General"),o=this.LoadStore("ExpireCache");for(const s of["ISRCLyrics","TrackInformation"]){var a=o[s];let e=!1;for(const c in a)a[c].ExpiresAt<Date.now()&&(delete a[c],e=!0);e&&this.SaveChanges("ExpireCache",s,JSON.stringify(a))}this.Store=e,this.ExpireCacheStore=o,localStorage.removeItem("BeautifulLyrics");for([t,r]of w){localStorage.removeItem(this.GetItemLocation("General",t,!1)),localStorage.removeItem(this.GetItemLocation("ExpireCache",t,!1));for(let e=1;e<r;e+=1)localStorage.removeItem(this.GetItemLocation("ExpireCache",t,e))}for([i,n]of C){localStorage.removeItem(this.GetItemLocation("General",i,!1));for(let e=1;e<n;e+=1)localStorage.removeItem(this.GetItemLocation("General",i,e))}}LoadStore(e){var t="General"===e?J:$,r={},i={};for(const o in t){var n=localStorage.getItem(this.GetItemLocation(e,o));null===n?i[o]=t[o]:r[o]=JSON.parse(n)}return a(a({},r),JSON.parse(JSON.stringify(i)))}GetItemLocation(e,t,r){r=void 0===r?"ExpireCache"===e?w.get(t):"General"===e?C.get(t):void 0:!1===r?void 0:r;return`BeautifulLyrics:${e}_`+t+(r?"_V"+r:"")}SaveChanges(e,t,r){localStorage.setItem(this.GetItemLocation(e,t),r)}GetExpireCache(e){return this.ExpireCacheStore[e]}GetDynamicItem(e){return null!=(e=localStorage.getItem(e))?e:void 0}SetDynamicItem(e,t){localStorage.setItem("BeautifulLyrics:Dynamic_"+e,t)}GetItem(e){return this.Store[e]}SaveItemChanges(e){this.SaveChanges("General",e,JSON.stringify(this.Store[e]))}GetFromExpireCache(e,t){var e=this.GetExpireCache(e),r=e[t];if(void 0!==r){if(!(r.ExpiresAt<Date.now()))return r.Content;delete e[t]}}SetExpireCacheItem(e,t,r,i){var n=this.GetExpireCache(e),o=new Date,i=(o.setHours(0,0,0,0),"Weeks"==i.Unit?o.setDate(o.getDate()+7*i.Duration):(o.setMonth(o.getMonth()+i.Duration),o.setDate(0)),o.getTime());n[t]={ExpiresAt:i,Content:r},this.SaveChanges("ExpireCache",e,JSON.stringify(n))}}),q={Duration:2,Unit:"Weeks"},W={Duration:1,Unit:"Months"},I=d.Give(new h),D=class{constructor(e,t){this.Id=e,this.CoverArt={Large:t.metadata.image_xlarge_url,Big:t.metadata.image_large_url,Default:t.metadata.image_url,Small:t.metadata.image_small_url}}},K=class extends D{constructor(e,t,r,i){super(e,t),this.ISRC=r.external_ids.isrc,this.LyricsData=i}},k=new s,G=new s,Q=/^spotify:track:([\w\d]+)$/,L=()=>{var e=null==(e=m.data)?void 0:e.track,t=(null!=(t=null==e?void 0:e.uri.match(Q))?t:[])[1];if(t!==(null==g?void 0:g.Id)){if(I.Clean("Song"),(g=void 0)!==t){var i=t;var r=e;const n=I.Give(new h,"Song");g=new D(i,r),new Promise(t=>{var e=x.GetFromExpireCache("TrackInformation",i);void 0===e?v.request("GET","https://api.spotify.com/v1/tracks/"+i).catch(e=>{throw console.warn(e),e}).then(e=>{if(e.status<200||299<e.status)throw`Failed to load Track (${i}) Information`;e=e.body;x.SetExpireCacheItem("TrackInformation",i,e,q),t(e)}):t(e)}).then(t=>{const r=t.external_ids.isrc;var e=x.GetFromExpireCache("ISRCLyrics",r);return void 0===e?fetch("https://beautiful-lyrics.socalifornian.live/lyrics/"+r).then(e=>{if(!1===e.ok)throw`Failed to load Lyrics for Track (${i}), Error: ${e.status} `+e.statusText;return e.text()}).then(e=>{if(0!==e.length)return JSON.parse(e)}).then(e=>(x.SetExpireCacheItem("ISRCLyrics",r,null!=e&&e,W),[t,e])):Promise.resolve([t,e||void 0])}).then(([e,t])=>{n.IsDestroyed()||(g=new K(i,r,e,t),G.Fire(g))})}k.Fire(g)}},X=k.GetEvent(),Y=(G.GetEvent(),()=>g),E=new s,Z=e=>{(null==e?void 0:e.CoverArt.Default)!==(null==f?void 0:f.Default)&&(f=null==e?void 0:e.CoverArt,E.Fire(f))},ee=E.GetEvent(),te=()=>f,re=e=>{e=e.match(/(\d+)\.(\d+)\.(\d+)(?:\.(\d+))?/);if(null!==e)return{Text:e[0],Major:parseInt(e[1]),Minor:parseInt(e[2]),Patch:parseInt(e[3]),Control:e[4]?parseInt(e[4]):void 0}},ie=re("2.5.7"),ne=async()=>{let n=1;fetch("https://api.github.com/repos/surfbryce/beautiful-lyrics/contents/dist/beautiful-lyrics.js").then(e=>e.json()).then(e=>fetch("https://api.github.com/repos/surfbryce/beautiful-lyrics/git/blobs/"+e.sha)).then(e=>e.json()).then(e=>atob(e.content)).then(e=>{var t,r,i=re(e);void 0!==i&&([t,r]=((e,t)=>{t={Text:"",Major:t.Major-e.Major,Minor:t.Minor-e.Minor,Patch:t.Patch-e.Patch,Control:void 0===t.Control&&void 0===e.Control?0:void 0===t.Control||void 0===e.Control?e.Control:t.Control-e.Control};return[t,0!==t.Major||0!==t.Minor||0!==t.Patch||0!==t.Control]})(ie,i),r&&(2<i.Major||2==i.Major&&4<=i.Minor)?(Spicetify.showNotification(`<h3>Beautiful Lyrics Updated!</h3>
				<h4 style = 'margin-top: 4px; margin-bottom: 4px; font-weight: normal;'>No need to re-install - it's already running!</h4>
				<span style = 'opacity: 0.75;'>Version ${ie.Text} -> ${i.Text}</span>`,t.Major<0||t.Minor<0||t.Patch<0||0<t.Major,7500),r=e,d.Destroy(),null!=(i=document.querySelector("#beautifulDlyrics"))&&i.remove(),(i=document.createElement("script")).setAttribute("type","text/javascript"),i.innerHTML=r,document.body.appendChild(i),y.remove()):n=5)}).catch(e=>console.warn("Error: "+e)).finally(()=>d.Give(l(60*n,ne),"CheckForUpdate"))};{const P=new Map,ae=(P.set("VanillaFullScreen","#main:has(.os-content .lyrics-lyrics-container) .under-main-view"),P.set("VanillaSideCard","aside:has(.main-nowPlayingView-section) .os-padding"),P.set("LyricsPlusFullScreen","#main:has(.os-content .lyrics-lyricsContainer-LyricsContainer) .under-main-view"),["lyrics-background-color","lyrics-background-back","lyrics-background-back-center"]),O=d.Give(new h,"LiveBackgrounds");b=()=>{for(var[e,t]of P){t=document.body.querySelector(t);(O.Has(e)?null===t:null!==t)&&(null===t?O.Clean(e):((e,t)=>{var r=O.Give(new h,e),i=r.Give(document.createElement("div"));i.classList.add("lyrics-background-container");const n=[];for(const a of ae){var o=r.Give(document.createElement("img"));o.classList.add(a),i.appendChild(o),n.push(o)}e=()=>{var e,t=null!=(e=null==(e=te())?void 0:e.Default)?e:"";for(const r of n)r.src=t},r.Give(ee.Connect(e)),e(),e=()=>{t.classList.contains("lyrics-background")||t.classList.add("lyrics-background")};e(),r.Give(new MutationObserver(e)).observe(t,{attributes:!0,attributeFilter:["class"],childList:!1,subtree:!1}),t.prepend(i),r.Give(()=>t.classList.remove("lyrics-background"))})(e,t))}}}{const F=4,se=.5,T=d.Give(new h,"Lyrics"),A=new Map,ce=(A.set("VanillaFullScreen",".lyrics-lyrics-contentWrapper"),A.set("VanillaSideCard",".main-nowPlayingView-lyricsContent"),"lyrics-lyricsContent-lyric"),le="lyrics-lyricsContent-unsynced",de="lyrics-lyricsContent-highlight",he="lyrics-lyricsContent-active",ye=e=>{var e=getComputedStyle(e),t=getComputedStyle(document.documentElement);return parseFloat(e.fontSize)/parseFloat(t.fontSize)},ue=(e,n)=>{const o=T.Give(new h,e),a=new Map;let s=0;const c=(e,t)=>{e.style.fontSize="Active"==t.State?s+se+"rem":""},l=()=>{let t;for(var[e,r]of a){e=e.classList;e.contains(he)?(r.State="Active",t=r.LayoutOrder):e.contains(le)?r.State="Unsynced":e.contains(de)?r.State="Sung":r.State="Unsung"}for(var[i,n]of a){var o="Active"===n.State||"Unsynced"===n.State;let e;e=o?0:void 0===t?F:Math.min(Math.abs(n.LayoutOrder-t),F);o=o?"var(--lyrics-color-active)":"Sung"===n.State?"var(--lyrics-color-passed)":"var(--lyrics-color-inactive)";!1===i.classList.contains("lyric")&&i.classList.add("lyric"),c(i,n),i.style.color="transparent",i.style.textShadow=`0 0 ${e}px `+o}};{const d=t=>{if(t instanceof HTMLDivElement&&t.classList.contains(ce)){var i=t;var t=o.Give(new h,i),r=Array.from(n.children).indexOf(i);t.Give(new MutationObserver(l)).observe(i,{attributes:!0,attributeFilter:["class"],childList:!1,subtree:!1});let e=!1;!1===o.Has("FontResizeObserver")&&0===i.innerText.length&&(o.Give(new ResizeObserver(e=>{s=ye(i);for(var[t,r]of a)c(t,r)}),"FontResizeObserver").observe(i),t.Give(()=>o.Clean("FontResizeObserver")),e=!0),a.set(i,{LayoutOrder:r,State:"Unsung",IsFontSizeObserver:e}),l()}};o.Give(new MutationObserver(e=>{for(const t of e)if("childList"===t.type){for(const r of t.removedNodes)r instanceof HTMLDivElement&&(a.delete(r),o.Clean(r));for(const i of t.addedNodes)d(i)}})).observe(n,{attributes:!1,childList:!0,subtree:!1});for(const t of n.childNodes)d(t)}};p=()=>{for(var[e,t]of A){t=document.body.querySelector(t);(T.Has(e)?null===t:null!==t)&&(null===t?T.Clean(e):ue(e,t))}}}var oe=async function(){await new Promise(e=>{S()?e():U.Connect(e)}),!1===B&&ne(),m.addEventListener("songchange",L),d.Give(()=>m.removeEventListener("songchange",L)),L(),d.Give(X.Connect(Z)),Z(Y()),d.Give(new MutationObserver(()=>{b(),p()})).observe(document.body,{attributes:!1,childList:!0,subtree:!0}),b(),p();{const i=()=>{d.Clean("Analytics");var e=x.GetItem("Analytics"),t=e.LastVisitedAt,t=void 0!==t?new Date(t):void 0,r=new Date,r=(r.setHours(0,0,0,0),r.getTime());(null==t?void 0:t.getTime())!==r&&(e.LastVisitedAt=r,x.SaveItemChanges("Analytics"),(t=d.Give(document.createElement("iframe"),"Analytics")).src="https://track.beautiful-lyrics.socalifornian.live/",t.style.display="none",document.body.appendChild(t)),l(60,i)};i()}};(async()=>{await oe()})()})();(async()=>{var e;document.getElementById("beautifulDlyrics")||((e=document.createElement("style")).id="beautifulDlyrics",e.textContent=String.raw`
  .main-lyricsCinema-controls,.main-nowPlayingView-lyricsControls{mix-blend-mode:overlay}.lyric:hover{text-shadow:0 0 0 var(--lyrics-color-active)!important}.lyrics-lyricsContent-active{margin-top:.25em;margin-bottom:.25em}aside:has(.main-nowPlayingView-section) .main-nowPlayingView-content{background:0 0}aside:has(.main-nowPlayingView-section) .lyrics-background .main-trackInfo-artists{opacity:.75;filter:brightness(1.15)}aside:has(.main-nowPlayingView-section) .main-nowPlayingView-coverArt{opacity:.85;box-shadow:rgba(0,0,0,.2705882353) 0 9px 20px 0}aside:has(.main-nowPlayingView-section) .main-nowPlayingView-section{background-color:var(--background-tinted-base)!important}#lyrics-cinema .os-scrollbar,.Root__main-view:has(.lyrics-background) .os-scrollbar,.os-host:has(.lyrics-background) .os-scrollbar{padding:5px}#lyrics-cinema .os-scrollbar .os-scrollbar-handle,.Root__main-view:has(.lyrics-background) .os-scrollbar .os-scrollbar-handle,.os-host:has(.lyrics-background) .os-scrollbar .os-scrollbar-handle{mix-blend-mode:overlay;background-color:rgba(252,249,249,.117)!important}.lyrics-lyrics-container,.main-nowPlayingView-section{--lyrics-color-inactive:rgb(240 240 240 / 51%)!important}.os-viewport .lyrics-lyrics-background{background:0 0}.os-viewport .lyrics-lyrics-container{margin-top:25vh}.os-viewport .lyrics-lyrics-container.lyrics-lyrics-coverTopBar{margin-top:7.5vh}.lyrics-lyricsContainer-LyricsBackground{background-color:transparent!important;background-image:none!important}#main:has(.under-main-view.lyrics-background) .Root__top-bar{mix-blend-mode:screen}.lyrics-background{overflow:hidden;position:static}.lyrics-background.main-nowPlayingView-sectionHeaderSpacing.main-nowPlayingView-lyricsGradient{background:0 0}.lyrics-background.os-viewport:not(:has(.main-nowPlayingView-content)){overflow:initial}#main:not(:has(.lyrics-lyricsContainer-LyricsBackground)) .lyrics-background.under-main-view>.lyrics-background-container{max-width:35%;max-height:30%;scale:290% 340%;transform-origin:left top}#main:has(.lyrics-lyricsContainer-LyricsBackground) .lyrics-background.under-main-view>.lyrics-background-container{max-width:25%;max-height:40%;scale:400% 250%;transform-origin:left top}#main:has(#lyrics-cinema .lyrics-lyrics-background) .lyrics-background.under-main-view .lyrics-background-container{z-index:1}.lyrics-background.os-padding:has(.main-nowPlayingView-content) .lyrics-background-container{border-radius:8px;filter:saturate(2) brightness(.7)}.lyrics-background-container{position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden;filter:saturate(1.5) brightness(.8)}.lyrics-background-back,.lyrics-background-back-center,.lyrics-background-color{position:absolute;width:200%;animation:rotate 35s linear infinite;filter:blur(40px);border-radius:100em}.lyrics-background-color{right:0;top:0;z-index:10;mix-blend-mode:revert}.lyrics-background-back{left:0;bottom:0;z-index:1;animation-direction:reverse}.lyrics-background-back-center{z-index:0;width:300%;right:-50%;top:-20%;animation-direction:reverse}@keyframes rotate{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}:root{--beautiful-lyrics-random-degree:258deg}@keyframes rotate{0%{transform:rotate(var(--beautiful-lyrics-random-degree))}100%{transform:rotate(calc(var(--beautiful-lyrics-random-degree) + 360deg))}}
      `.trim(),document.head.appendChild(e))})();